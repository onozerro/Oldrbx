<!doctype html>
<html lang="en" class="h-100">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link rel="icon" type="image/png" href="img/ic.png" />
    <title>Application Check - OLDRBX</title>
    <meta name="description" content="Check the status of your application via its ID." />
    <meta name="twitter:card" content="summary" />
    <meta property="og:site_name" content="OLDRBX" />
    <meta property="og:url" content="https://OLDRBX.lol/auth/application-check" />
    <meta property="og:title" content="Application Check" />
    <meta property="og:description" content="Check the status of your application via its ID." />
    <meta property="og:image" content="https://OLDRBX.lol/img/OLDRBXC.png" />
    <style>
        body {
        background-color: #0c0c0cff !important;
        color: #ffffff !important;
        }
        .navbar.bg-dark {
            background-color: #0b0b0b !important;
            border-bottom: 2px solid #3d3d3dff !important;
        }
        footer.bg-dark {
            background-color: #0b0b0b !important;
            border-top: 2px solid #3d3d3dff !important;
        }
        footer .text-muted {
            color: #3d3d3dff !important;
        }
        .exchcont {
            max-width: 420px;
            margin: 50px auto;
        }
        .exchcard {
            background-color: #121212;
            border: 1px solid #2a2a2a;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.05);
            padding: 25px;
        }
        .exchcard h2 {
            text-align: center;
            margin-bottom: 20px;
            font-weight: 700;
            color: #ffffff;
        }
        .exchcard p {
            color: #ffffff;
            font-size: 0.95rem;
        }
        .exchcard .form-control {
            background-color: #1b1b1b;
            color: #ffffff;
            border: 1px solid #3a3a3a;
            border-radius: 5px;
            padding: 8px;
            width: 100%;
            margin-top: 10px;
        }
        .exchcard .form-control:focus {
            background-color: #1e1e1e;
            border-color: #1a73e8;
            box-shadow: 0 0 0 0.2rem rgba(26, 115, 232, 0.25);
            color: #ffffff;
        }
        .exchcard .btn-primary {
            background-color: #1a73e8;
            border-color: #1a73e8;
            color: #fff;
            width: 100%;
            margin-top: 15px;
        }
        .table-row {
            background: rgba(255,255,255,0.02);
            border-radius:6px;
            padding:12px;
            margin-bottom:8px;
        }
        .label {
            color:#8f8f8f;
            font-size:13px;
        }
        .value {
            color:#fff;
            word-break:break-word;
        }
        .not-found {
            text-align:center;
            padding:18px;
            color:#ffb3b3;
        }
    </style>
</head>
<body class="d-flex flex-column h-100">

<main class="flex-shrink-0">
<div class="exchcont">
    <div class="exchcard">
        <h2>View Application Status</h2>

        <form id="lookupForm" class="mt-3">
            <input id="ticketInput" type="text" class="form-control" placeholder="Application ID" maxlength="128" />
            <input type="submit" class="btn btn-primary mt-4" value="Lookup" />
        </form>

        <div id="resultArea" class="mt-3"></div>
    </div>
</div>
</main>

<footer class="footer mt-auto py-3 bg-dark">
    <div class="container">
        <p class="text-muted mb-0 text-center">&copy; 2026 OLDRBX</p>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const SUPA_URL = "https://nkvvnnjukqtfhmegyzek.supabase.co";
  const SUPA_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rdnZubmp1a3F0ZmhtZWd5emVrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg2NjQ5MTIsImV4cCI6MjA4NDI0MDkxMn0.2jp9X2KQunFargrstYM7oGBYs75Kq7AEHs7iRARxexs";
  const sb = supabase.createClient(SUPA_URL, SUPA_KEY);

  const ticketInput = document.getElementById("ticketInput");
  const lookupForm = document.getElementById("lookupForm");
  const resultArea = document.getElementById("resultArea");

  async function fetchApplication(ticket) {
    resultArea.innerHTML = '<div style="color:#8f8f8f">Searching...</div>';

    const { data } = await sb
      .from("applications")
      .select("*")
      .eq("ticket_id", ticket)
      .limit(1)
      .order("created_at", { ascending: false });

    if (!data || !data.length) {
      resultArea.innerHTML = '<div class="not-found">Application not found</div>';
      return;
    }

    const app = data[0];
    const wrap = document.createElement("div");

    [
      ["Ticket", app.ticket_id],
      ["About", app.about],
      ["Social URL", app.social_url],
      ["Status", app.status],
      ["Created At", app.created_at ? new Date(app.created_at).toLocaleString() : ""]
    ].forEach(r => {
      const el = document.createElement("div");
      el.className = "table-row";
      el.innerHTML = `<div class="label">${r[0]}</div><div class="value">${r[1] || "&mdash;"}</div>`;
      wrap.appendChild(el);
    });

    if (app.status && app.status.toLowerCase() === "approved") {
      const btn = document.createElement("a");
      btn.href = "register.html";
      btn.className = "btn btn-primary";
      btn.textContent = "REGISTER";
      wrap.appendChild(btn);
    }

    resultArea.innerHTML = "";
    resultArea.appendChild(wrap);
  }

  lookupForm.addEventListener("submit", function (e) {
    e.preventDefault();
    if (ticketInput.value.trim()) {
      fetchApplication(ticketInput.value.trim());
    }
  });
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
