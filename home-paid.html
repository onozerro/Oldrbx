<!doctype html>
<html lang="ru" class="h-100">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Home - OLDRBX</title>
<link rel="icon" type="image/png" href="img/ic.png">
<style>
:root{
  --bg:#e9e9ea;
  --top:#0074bd;
  --panel:#ffffff;
  --muted:#6f6f6f;
  --border:#d5d7d9;
  --accent:#0074bd;
  --shadow:rgba(0,0,0,0.06);
}
html,body{height:100%;margin:0;background:var(--bg);color:#111;font-family:Arial,Helvetica,sans-serif}
.topbar{height:56px;background:var(--top);display:flex;align-items:center;padding:0 14px;gap:12px;box-sizing:border-box}
.hamburger{width:44px;height:44px;border-radius:6px;background:transparent;border:none;color:#fff;font-size:22px;display:flex;align-items:center;justify-content:center;cursor:pointer}
.logo-img{height:34px}
.top-right{margin-left:auto;display:flex;align-items:center;gap:10px}
.money-wrap{display:flex;align-items:center;gap:8px;background:rgba(255,255,255,0.06);padding:6px 8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);font-weight:800;color:#fff}
.money-icon{width:28px;height:28px;border-radius:50%;overflow:hidden;background:#fff;display:flex;align-items:center;justify-content:center}
.money-icon img{width:100%;height:100%;object-fit:cover}
.balance{color:#fff;font-weight:800}
.avatar{width:40px;height:40px;border-radius:50%;overflow:hidden;background:var(--panel);display:flex;align-items:center;justify-content:center}
.avatar img{width:100%;height:100%;object-fit:cover;border-radius:50%}
.container{padding:18px;box-sizing:border-box}
.header-row{display:flex;align-items:center;gap:12px;margin-bottom:12px}
.header-title{font-weight:800;font-size:18px}
.container-layout{display:grid;grid-template-columns:320px 1fr;gap:18px}
.sidebar{background:var(--panel);border:1px solid var(--border);border-radius:6px;padding:12px;box-sizing:border-box}
.topics-grid{display:flex;flex-direction:column;gap:10px}
.topic-btn{display:flex;align-items:center;justify-content:space-between;padding:12px;background:#fff;border:1px solid var(--border);border-radius:6px;cursor:pointer;font-weight:800;box-shadow:0 6px 14px var(--shadow);gap:12px}
.topic-btn .left{display:flex;flex-direction:column;gap:4px;align-items:flex-start}
.topic-btn .title{font-weight:800}
.topic-btn .meta{font-size:12px;color:var(--muted);font-weight:700}
.topic-btn .right{display:flex;flex-direction:column;align-items:flex-end;gap:6px}
.count-pill{background:#f3f5f6;border:1px solid var(--border);padding:6px 10px;border-radius:6px;font-weight:800;font-size:13px}
.mainpanel{background:var(--panel);border:1px solid var(--border);border-radius:6px;padding:14px;min-height:420px;display:flex;flex-direction:column}
.card{background:var(--panel);border:1px solid var(--border);border-radius:6px;padding:16px;box-sizing:border-box;box-shadow:0 6px 14px var(--shadow)}
.center-block{text-align:center;margin-top:8px}
.splash{width:220px;height:220px;object-fit:cover;border-radius:6px;border:1px solid var(--border);background:#fff;margin:0 auto;display:block}
.splash-title{margin-top:12px;color:var(--muted);font-size:15px;font-weight:700}
.composer{margin-top:12px;display:flex;gap:10px;align-items:flex-start}
.composer textarea{flex:1;min-height:90px;background:#fafafa;border:1px solid var(--border);color:#111;padding:10px;border-radius:6px;resize:vertical}
.composer button{height:40px;border-radius:6px;background:var(--accent);color:#fff;border:none;padding:8px 14px;cursor:pointer;font-weight:800;box-shadow:0 6px 14px var(--shadow)}
.empty{color:var(--muted);padding:18px;text-align:center}
.footer{background:var(--panel);border-top:1px solid var(--border);padding:10px;text-align:center;color:var(--muted);margin-top:18px;border-radius:6px}
@media(max-width:1000px){
  .container-layout{grid-template-columns:1fr;padding:12px}
  .sidebar{position:fixed;left:-360px;top:56px;height:calc(100% - 56px);z-index:1050;transition:left .18s ease}
  .sidebar.open{left:0}
}
</style>
</head>
<body>
<div class="topbar">
  <button id="hamb" class="hamburger" aria-label="menu">&#9776;</button>
  <img src="img/logo.png" class="logo-img" alt="logo">
  <div class="top-right">
    <div class="money-wrap">
      <div class="money-icon"><img id="moneyIcon" src="img/money.png" alt="money"></div>
      <div class="balance" id="balanceText">0</div>
    </div>
    <div class="avatar"><img id="topAv" src="img/user.png" alt="avatar"></div>
  </div>
</div>

<div class="container">
  <div class="header-row">
    <div class="header-title">Home</div>
  </div>

  <div class="container-layout">
    <aside class="sidebar" id="leftSidebar">
      <div class="topics-grid" id="navList">
        <div class="topic-btn" data-href="home-paid.html"><div class="left"><div class="title">Home</div></div></div>
        <div class="topic-btn" data-href="forums-paid.html"><div class="left"><div class="title">Forums</div></div></div>
        <div class="topic-btn" data-href="messages.html"><div class="left"><div class="title">Messages</div></div></div>
        <div class="topic-btn locked"><div class="left"><div class="title">Profile</div></div></div>
      </div>
    </aside>

    <main class="mainpanel">
      <div class="card">
        <h3 id="hello">Hello</h3>
        <p style="color:var(--muted);margin-top:8px">Добро пожаловать на домашнюю страницу.</p>
        <div class="center-block">
          <img src="img/sorry.png" class="splash" alt="sorry">
          <div class="splash-title">Temporary limitations during development</div>
        </div>

        <div id="topicsPreview" style="margin-top:18px">
          <div style="font-weight:800;margin-bottom:8px">Quick actions</div>
          <div style="display:flex;flex-direction:column;gap:10px" id="previewList"></div>
        </div>

        <div style="display:flex;justify-content:flex-end;margin-top:12px">
          <button id="logout" class="composer-button composer-btn composer-send" onclick="">Logout</button>
        </div>
      </div>
      <div class="footer">&copy; 2026 OLDRBX</div>
    </main>
  </div>
</div>

<script>
(function(){
  var sid=document.getElementById('leftSidebar')
  var hamb=document.getElementById('hamb')
  try{var auth=JSON.parse(localStorage.getItem('auth'))}catch(e){auth=null}
  if(!auth||!auth.username){location.replace('login.html');return}
  document.getElementById('hello').innerText='Hello, '+String(auth.username)
  document.getElementById('topAv').src=auth.avatarUrl||'img/user.png'
  var bal = (typeof auth.balance !== 'undefined' && auth.balance !== null) ? auth.balance : 0
  document.getElementById('balanceText').innerText = String(bal)
  document.getElementById('moneyIcon').src = 'img/money.png'
  document.getElementById('logout').onclick=function(){try{localStorage.removeItem('auth')}catch(e){}location.replace('login.html')}

  hamb.addEventListener('click',function(){sid.classList.toggle('open')})
  function openOnDesktop(){if(window.innerWidth>=1000)sid.classList.add('open');else sid.classList.remove('open')}
  window.addEventListener('resize',openOnDesktop)
  openOnDesktop()

  document.querySelectorAll('.topic-btn[data-href]').forEach(function(el){
    el.addEventListener('click', function(){ location.href = el.dataset.href })
  })

  (async function loadPreview(){
    try{
      const SUPA_URL = "https://nkvvnnjukqtfhmegyzek.supabase.co";
      const SUPA_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rdnZubmp1a3F0ZmhtZWd5emVrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg2NjQ5MTIsImV4cCI6MjA4NDI0MDkxMn0.2jp9X2KQunFargrstYM7oGBYs75Kq7AEHs7iRARxexs";
      const sb = window.supabase ? window.supabase : null;
      if(!sb && window.fetch){
        // try lightweight fetch to get topics count for preview (no library)
        const resp = await fetch(SUPA_URL + '/rest/v1/forum_topics?select=*,forum_posts(id)&order=id', { method: 'GET', headers: { apikey: SUPA_KEY, Authorization: 'Bearer ' + SUPA_KEY } }).catch(()=>null)
        if(resp && resp.ok){
          const data = await resp.json()
          const container = document.getElementById('previewList')
          container.innerHTML = ''
          data.forEach(function(t){
            var count = (t.forum_posts && t.forum_posts.length) ? t.forum_posts.length : 0
            var el = document.createElement('div'); el.className='topic-btn'; el.innerHTML = '<div class="left"><div class="title">'+(t.title||'Untitled')+'</div><div class="meta">Topics • '+count+' messages</div></div><div class="right"><div class="count-pill">'+count+'</div></div>';
            el.addEventListener('click',function(){ location.href='forums-paid.html' })
            container.appendChild(el)
          })
          return
        }
      }
      // fallback: show static placeholders
      var container = document.getElementById('previewList')
      container.innerHTML = ''
      ['News','Updates','General'].forEach(function(t,i){
        var el = document.createElement('div'); el.className='topic-btn'; el.innerHTML = '<div class="left"><div class="title">'+t+'</div><div class="meta">—</div></div><div class="right"><div class="count-pill">0</div></div>';
        el.addEventListener('click',function(){ location.href='forums-paid.html' })
        container.appendChild(el)
      })
    }catch(e){}
  })();
})();
</script>
</body>
</html>
